/home/qlyu/AA_peptide/pepland/claude_test/train_large_contrastive_fixed.py:186: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler = GradScaler()
============================================================
对比学习预训练 - 修复版 + 大规模数据
============================================================

设备: cuda:0 (物理GPU 2)

配置 (优化版):
  data_dir: data_large
  batch_size: 32
  hidden_dim: 256
  num_layers: 6
  num_heads: 8
  dropout: 0.1
  projection_dim: 128
  temperature: 0.5 ← 增加
  learning_rate: 5e-05 ← 降低
  weight_decay: 1e-05
  num_epochs: 50
  max_samples: None

加载数据...
加载数据: data_large/train.csv
  总样本数: 853
  有效样本数: 853
加载数据: data_large/valid.csv
  总样本数: 107
  有效样本数: 107
加载数据: data_large/test.csv
  总样本数: 107
  有效样本数: 107

创建编码器...
  模型参数量: 6,750,863

开始预训练...
------------------------------------------------------------
训练:   0%|          | 0/27 [00:00<?, ?it/s]/home/qlyu/AA_peptide/pepland/claude_test/train_large_contrastive_fixed.py:62: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with autocast():
/home/qlyu/anaconda3/envs/cuda12.1/lib/python3.11/site-packages/dgl/backend/pytorch/sparse.py:157: FutureWarning: `torch.cuda.amp.autocast_mode._cast(value, dtype)` is deprecated. Please use `torch.amp.autocast_mode._cast(value, 'cuda', dtype)` instead.
  return th.cuda.amp.autocast_mode._cast(
/home/qlyu/anaconda3/envs/cuda12.1/lib/python3.11/site-packages/dgl/backend/pytorch/sparse.py:148: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  return th.cuda.amp.autocast(enabled=False)
训练:   4%|▎         | 1/27 [00:01<00:46,  1.78s/it]训练:   7%|▋         | 2/27 [00:02<00:28,  1.14s/it]训练:  11%|█         | 3/27 [00:03<00:22,  1.08it/s]训练:  15%|█▍        | 4/27 [00:04<00:22,  1.03it/s]训练:  19%|█▊        | 5/27 [00:05<00:20,  1.06it/s]训练:  22%|██▏       | 6/27 [00:05<00:18,  1.17it/s]训练:  26%|██▌       | 7/27 [00:06<00:15,  1.26it/s]训练:  30%|██▉       | 8/27 [00:07<00:14,  1.28it/s]训练:  33%|███▎      | 9/27 [00:08<00:14,  1.21it/s]训练:  37%|███▋      | 10/27 [00:08<00:14,  1.19it/s]训练:  41%|████      | 11/27 [00:10<00:15,  1.06it/s]训练:  44%|████▍     | 12/27 [00:11<00:14,  1.04it/s]训练:  48%|████▊     | 13/27 [00:12<00:13,  1.05it/s]训练:  52%|█████▏    | 14/27 [00:12<00:10,  1.26it/s]训练:  56%|█████▌    | 15/27 [00:12<00:08,  1.43it/s]训练:  59%|█████▉    | 16/27 [00:13<00:08,  1.32it/s]训练:  63%|██████▎   | 17/27 [00:14<00:06,  1.48it/s]训练:  67%|██████▋   | 18/27 [00:15<00:06,  1.39it/s]训练:  70%|███████   | 19/27 [00:16<00:06,  1.31it/s]训练:  74%|███████▍  | 20/27 [00:17<00:06,  1.09it/s]训练:  78%|███████▊  | 21/27 [00:18<00:05,  1.10it/s]训练:  81%|████████▏ | 22/27 [00:19<00:04,  1.13it/s]训练:  85%|████████▌ | 23/27 [00:19<00:03,  1.21it/s]训练:  89%|████████▉ | 24/27 [00:20<00:02,  1.10it/s]训练:  93%|█████████▎| 25/27 [00:21<00:01,  1.15it/s]训练:  96%|█████████▋| 26/27 [00:22<00:00,  1.15it/s]训练: 100%|██████████| 27/27 [00:23<00:00,  1.14it/s]训练: 100%|██████████| 27/27 [00:23<00:00,  1.15it/s]
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
Epoch 1/50: Loss=0.0000, Time=23.4s
  ✓ 保存最佳模型 (loss=0.0000)
训练:   0%|          | 0/27 [00:00<?, ?it/s]训练:   4%|▎         | 1/27 [00:00<00:25,  1.03it/s]训练:   7%|▋         | 2/27 [00:01<00:18,  1.32it/s]训练:  11%|█         | 3/27 [00:02<00:17,  1.41it/s]训练:  15%|█▍        | 4/27 [00:02<00:14,  1.62it/s]训练:  19%|█▊        | 5/27 [00:03<00:16,  1.32it/s]训练:  22%|██▏       | 6/27 [00:04<00:14,  1.43it/s]训练:  26%|██▌       | 7/27 [00:05<00:14,  1.35it/s]训练:  30%|██▉       | 8/27 [00:06<00:14,  1.27it/s]训练:  33%|███▎      | 9/27 [00:07<00:17,  1.01it/s]训练:  37%|███▋      | 10/27 [00:08<00:16,  1.05it/s]训练:  41%|████      | 11/27 [00:09<00:14,  1.08it/s]训练:  44%|████▍     | 12/27 [00:10<00:15,  1.02s/it]训练:  48%|████▊     | 13/27 [00:11<00:13,  1.07it/s]训练:  52%|█████▏    | 14/27 [00:11<00:11,  1.15it/s]训练:  56%|█████▌    | 15/27 [00:12<00:09,  1.32it/s]训练:  59%|█████▉    | 16/27 [00:13<00:09,  1.14it/s]训练:  63%|██████▎   | 17/27 [00:14<00:08,  1.22it/s]训练:  67%|██████▋   | 18/27 [00:15<00:07,  1.22it/s]训练:  70%|███████   | 19/27 [00:15<00:06,  1.19it/s]训练:  74%|███████▍  | 20/27 [00:17<00:06,  1.02it/s]训练:  78%|███████▊  | 21/27 [00:17<00:05,  1.13it/s]训练:  81%|████████▏ | 22/27 [00:18<00:04,  1.19it/s]训练:  85%|████████▌ | 23/27 [00:19<00:03,  1.27it/s]训练:  89%|████████▉ | 24/27 [00:20<00:02,  1.11it/s]训练:  93%|█████████▎| 25/27 [00:21<00:01,  1.12it/s]训练:  96%|█████████▋| 26/27 [00:22<00:00,  1.11it/s]训练: 100%|██████████| 27/27 [00:22<00:00,  1.20it/s]训练: 100%|██████████| 27/27 [00:22<00:00,  1.18it/s]
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
Epoch 2/50: Loss=0.0000, Time=22.9s
训练:   0%|          | 0/27 [00:00<?, ?it/s]训练:   4%|▎         | 1/27 [00:01<00:29,  1.14s/it]训练:   7%|▋         | 2/27 [00:01<00:22,  1.14it/s]训练:  11%|█         | 3/27 [00:02<00:15,  1.53it/s]训练:  15%|█▍        | 4/27 [00:02<00:12,  1.88it/s]训练:  19%|█▊        | 5/27 [00:03<00:13,  1.68it/s]训练:  22%|██▏       | 6/27 [00:04<00:16,  1.27it/s]训练:  26%|██▌       | 7/27 [00:05<00:17,  1.17it/s]训练:  30%|██▉       | 8/27 [00:06<00:16,  1.18it/s]训练:  33%|███▎      | 9/27 [00:07<00:17,  1.01it/s]训练:  37%|███▋      | 10/27 [00:08<00:16,  1.03it/s]训练:  41%|████      | 11/27 [00:09<00:14,  1.13it/s]训练:  44%|████▍     | 12/27 [00:09<00:12,  1.19it/s]训练:  48%|████▊     | 13/27 [00:10<00:11,  1.26it/s]训练:  52%|█████▏    | 14/27 [00:11<00:11,  1.10it/s]训练:  56%|█████▌    | 15/27 [00:12<00:10,  1.20it/s]训练:  59%|█████▉    | 16/27 [00:13<00:08,  1.25it/s]训练:  63%|██████▎   | 17/27 [00:13<00:07,  1.28it/s]训练:  67%|██████▋   | 18/27 [00:15<00:08,  1.07it/s]训练:  70%|███████   | 19/27 [00:16<00:07,  1.10it/s]训练:  74%|███████▍  | 20/27 [00:16<00:06,  1.15it/s]训练:  78%|███████▊  | 21/27 [00:17<00:04,  1.23it/s]训练:  81%|████████▏ | 22/27 [00:18<00:04,  1.05it/s]训练:  85%|████████▌ | 23/27 [00:19<00:03,  1.07it/s]训练:  89%|████████▉ | 24/27 [00:20<00:02,  1.14it/s]训练:  93%|█████████▎| 25/27 [00:21<00:02,  1.03s/it]训练:  96%|█████████▋| 26/27 [00:22<00:00,  1.00it/s]训练: 100%|██████████| 27/27 [00:23<00:00,  1.12it/s]训练: 100%|██████████| 27/27 [00:23<00:00,  1.15it/s]
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
Epoch 3/50: Loss=0.0000, Time=23.4s
训练:   0%|          | 0/27 [00:00<?, ?it/s]训练:   4%|▎         | 1/27 [00:00<00:11,  2.25it/s]训练:   7%|▋         | 2/27 [00:00<00:11,  2.18it/s]训练:  11%|█         | 3/27 [00:01<00:17,  1.40it/s]训练:  15%|█▍        | 4/27 [00:02<00:13,  1.75it/s]训练:  19%|█▊        | 5/27 [00:03<00:14,  1.52it/s]训练:  22%|██▏       | 6/27 [00:03<00:15,  1.37it/s]训练:  26%|██▌       | 7/27 [00:05<00:18,  1.06it/s]训练:  30%|██▉       | 8/27 [00:06<00:17,  1.06it/s]训练:  33%|███▎      | 9/27 [00:07<00:16,  1.11it/s]训练:  37%|███▋      | 10/27 [00:07<00:14,  1.20it/s]训练:  41%|████      | 11/27 [00:08<00:14,  1.08it/s]训练:  44%|████▍     | 12/27 [00:09<00:12,  1.18it/s]训练:  48%|████▊     | 13/27 [00:10<00:12,  1.15it/s]训练:  52%|█████▏    | 14/27 [00:11<00:10,  1.22it/s]训练:  56%|█████▌    | 15/27 [00:12<00:11,  1.09it/s]训练:  59%|█████▉    | 16/27 [00:12<00:09,  1.21it/s]训练:  63%|██████▎   | 17/27 [00:13<00:08,  1.23it/s]训练:  67%|██████▋   | 18/27 [00:14<00:06,  1.29it/s]训练:  70%|███████   | 19/27 [00:15<00:07,  1.09it/s]训练:  74%|███████▍  | 20/27 [00:16<00:06,  1.13it/s]训练:  78%|███████▊  | 21/27 [00:17<00:05,  1.17it/s]训练:  81%|████████▏ | 22/27 [00:17<00:04,  1.25it/s]训练:  85%|████████▌ | 23/27 [00:19<00:03,  1.10it/s]训练:  89%|████████▉ | 24/27 [00:19<00:02,  1.12it/s]训练:  93%|█████████▎| 25/27 [00:20<00:01,  1.13it/s]训练:  96%|█████████▋| 26/27 [00:22<00:01,  1.02s/it]训练: 100%|██████████| 27/27 [00:22<00:00,  1.11it/s]训练: 100%|██████████| 27/27 [00:22<00:00,  1.18it/s]
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
  训练错误: value cannot be converted to type at::Half without overflow
Epoch 4/50: Loss=0.0000, Time=22.8s
训练:   0%|          | 0/27 [00:00<?, ?it/s]训练:   4%|▎         | 1/27 [00:00<00:20,  1.27it/s]训练:   7%|▋         | 2/27 [00:01<00:17,  1.44it/s]训练:  11%|█         | 3/27 [00:01<00:14,  1.69it/s]训练:  15%|█▍        | 4/27 [00:02<00:17,  1.34it/s]训练:  19%|█▊        | 5/27 [00:03<00:16,  1.36it/s]训练:  22%|██▏       | 6/27 [00:04<00:16,  1.28it/s]训练:  26%|██▌       | 7/27 [00:05<00:15,  1.30it/s]训练:  30%|██▉       | 8/27 [00:06<00:18,  1.04it/s]训练:  33%|███▎      | 9/27 [00:07<00:17,  1.05it/s]训练:  37%|███▋      | 10/27 [00:08<00:16,  1.03it/s]训练:  41%|████      | 11/27 [00:09<00:16,  1.01s/it]