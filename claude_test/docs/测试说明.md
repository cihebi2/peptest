# Claude Test 测试说明

## 测试日志 / Test Log

**开始时间**: 2025-10-14 11:52

---

## 阶段 1: DGL 编译和安装

### 1.1 DGL 源码编译
- **时间**: 2025-10-14 11:52 开始
- **状态**: ❌ 编译失败
- **方法**: 从 GitHub 源码编译 DGL v1.1.3
- **原因**: 系统 GLIBC 2.17 太旧，预编译版本需要 GLIBC 2.27
- **进度**:
  - ✅ 克隆 DGL 仓库
  - ✅ 克隆子模块（所有第三方库）
  - ✅ 检出 v1.1.3 版本
  - ❌ CMake 配置失败

**错误信息**:
1. 未找到 nvcc (CUDA 编译器)
2. GCC 4.8.5 太旧，不支持 C++17 (DGL 需要 C++17)

**解决方案**: 改用预编译的旧版本 DGL

### 1.2 安装预编译 DGL (Plan B)
- **时间**: 2025-10-14 12:05
- **状态**: ⏳ 待执行
- **方法**: 安装 DGL 0.9.1 版本（支持 GLIBC 2.17）
- **命令**:
```bash
pip uninstall dgl dglgo -y
pip install dgl-cu117==0.9.1 -f https://data.dgl.ai/wheels/repo.html
```

---

## 待执行测试计划

### 阶段 2: 基础功能测试
- [ ] 2.1 DGL + CUDA 基础测试
- [ ] 2.2 图创建和批处理
- [ ] 2.3 异构图支持

### 阶段 3: 模型组件测试
- [ ] 3.1 Performer Attention 测试
- [ ] 3.2 Graphormer Layer 测试
- [ ] 3.3 Hierarchical Pooling 测试
- [ ] 3.4 完整模型前向传播测试

### 阶段 4: 预训练模块测试
- [ ] 4.1 数据增强测试
- [ ] 4.2 对比学习测试
- [ ] 4.3 MoCo 框架测试

### 阶段 5: 数据集成
- [ ] 5.1 分析原始 pepland 数据格式
- [ ] 5.2 创建数据转换器
- [ ] 5.3 创建 DataLoader
- [ ] 5.4 测试数据加载流程

### 阶段 6: 端到端测试
- [ ] 6.1 预训练流程测试（小数据集）
- [ ] 6.2 微调流程测试
- [ ] 6.3 评估流程测试

### 阶段 7: 完整训练
- [ ] 7.1 在真实数据上预训练
- [ ] 7.2 在下游任务上微调
- [ ] 7.3 性能评估和对比

---

## 系统信息

- **工作目录**: `/home/qlyu/AA_peptide/pepland/claude_test`
- **Python**: 3.11.13
- **PyTorch**: 2.6.0+cu124
- **CUDA**: 12.4
- **GPU**: NVIDIA RTX 4090 (使用 GPU 3)
- **环境**: cuda12.1

---

## 更新历史

本文档会在每次测试后自动更新。

---

---

## 阶段 2: 模型测试 (已完成)

### 2.1 模型组件测试 ✅
- **时间**: 2025-10-14 12:50
- **状态**: ✅ 通过
- **测试内容**:
  - Performer attention
  - Hierarchical pooling
  - 完整 ImprovedPepLand 模型
- **测试结果**:
  - 前向传播 ✅
  - 批处理 ✅
  - 反向传播 ✅
- **修复的Bug**:
  1. `improved_pepland.py:217` - bool vs tensor 类型
  2. `hierarchical_pool.py:139` - view() → reshape()

### 2.2 DGL 安装完成 ✅
- **版本**: DGL 1.1.3+cu121
- **方法**: 预编译版本（兼容 GLIBC 2.17）
- **CUDA**: 12.1
- **测试**: ✅ 所有功能正常

---

*最后更新: 2025-10-14 13:00*
